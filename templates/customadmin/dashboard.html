<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"> 
</head>
<body>
  <div class="sidebar">
    <h2><span class="admin-color">Admin</span> <span class="panel-color">Panel</span></h2>
    <ul>
        <li><a href="#" class="active" id="dashboardLink"><i class="fas fa-home"></i> Dashboard</a></li>
        <li><a href="#" id="usersLink"><i class="users"></i> Users</a></li>
        <li><a href="#" id="sellersLink"><i class="link"></i> Sellers</a></li>
        <li><a href="#" id="productsLink"><i class="tshirt"></i> Products</a></li>
        <li><a href="#" id="teamsLink"><i class="users"></i> Our Teams</a></li> 
        <br>
        <br>
        <br>
        <li><a href="{% url 'admin_logout' %}"><i class="fas fa-link"></i>Logout</a></li>
 </div>
  <div class="container mt-4 ml-5" id="dashboardSection">
    <div class="row">
      <div class="col-md-4">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Total Sales</h5>
            <p class="card-text">$12,00,000</p>
            <a href="#" class="btn btn-primary">Check Out</a>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Total Orders</h5>
            <p class="card-text">50</p>
            <a href="#" class="btn btn-primary">Check Out</a>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Total Products</h5>
            <p class="card-text">82</p>
            <a href="#" class="btn btn-primary">Check Out</a>
          </div>
        </div>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-md-12">
        <h2>Recent Orders</h2>
        <table class="table">
          <thead class="thead-dark">
            <tr>
              <th scope="col">Order ID</th>
              <th scope="col">Customer Name</th>
              <th scope="col">Order Date</th>
              <th scope="col">Email</th>
              <th scope="col">Total Amount</th>
            </tr>
          </thead>
          <tbody>
            <!-- Sample data, replace with dynamic data -->
            <tr>
              <th scope="row">1</th>
              <td>John Doe</td>
              <td>2024-04-01</td>
              <td>john@example.com</td>
              <td>$100</td>
            </tr>
            <tr>
              <th scope="row">2</th>
              <td>Jane Smith</td>
              <td>2024-04-02</td>
              <td>jane@example.com</td>
              <td>$150</td>
            </tr>
            <!-- More rows here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- User table, initially hidden -->
  <div id="usersSection" style="display: none;">
    <div class="container mt-4 ml-5">
      <div class="row">
        <div class="col-md-12">
          <h2>Recent Users</h2>

          <table class="table">
            <thead>
                <tr>
                    <th>User ID</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                    <th>Date Joined</th>
                    <th>Last Login</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}  <!-- Loop through the users context variable -->
                <tr>
                    <td>{{ user.id }}</td>  <!-- User ID -->
                    <td>{{ user.first_name }}</td>  <!-- First Name -->
                    <td>{{ user.last_name }}</td>  <!-- Last Name -->
                    <td>{{ user.email }}</td>  <!-- Email -->
                    <td>{{ user.date_joined|date:"jS F, Y" }}</td>  <!-- Date Joined -->
                    <td>
                        {% if user.last_login %}
                            {{ user.last_login|date:"jS F, Y H:i" }}  <!-- Last Login with time -->
                        {% else %}
                            Never
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        </div>
      </div>
    </div>
  </div>
  <!-- Add and delete buttons for users, initially hidden -->
  <div id="userButtons" style="display: none;">
    <div class="container mt-4 ml-5">
      <div class="row">
      </div>
    </div>
    <div class="modal fade" id="addUserModal" tabindex="-1" role="dialog" aria-labelledby="addUserModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addUserModalLabel">Add User</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="addUserForm">
              <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" class="form-control" id="name" required>
              </div>
              <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" class="form-control" id="email" required>
              </div>
              <div class="form-group">
                <label for="phone">Phone Number:</label>
                <input type="tel" class="form-control" id="phone" required>
              </div>
              <div class="form-group">
                <label for="location">Location:</label>
                <input type="text" class="form-control" id="location" required>
              </div>
              <div class="form-group">
                <label for="dateJoined">Date of Joined:</label>
                <input type="date" class="form-control" id="dateJoined" required>
              </div>
            </form>
          </div>
        </div>
        </div>
        </div>
  </div>

  <!-- Seller table, initially hidden -->
  <div id="sellersSection" style="display: none;">
    <div class="container mt-4 ml-5">
      <div class="row">
        <div class="col-md-12">
          <h2>Recent Sellers</h2>
          <table class="table">
            <thead class="thead-dark">
              <tr>
                <th scope="col">Seller ID</th>
                <th scope="col">Name</th>
                <th scope="col">Email</th>
                <th scope="col">Contact Number</th>
                <th scope="col">Date of Joined</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Sample data, replace with dynamic data -->
              <tr>
                <th scope="row">1</th>
                <td>Ram Bahadur</td>
                <td>example.com</td>
                <td>+2356457631</td>
                <td>21st December,2023</td>
                <td><button class="btn btn-danger delete-user-btn">Delete</button></td>
              </tr>
              <tr>
              <!-- Mor-->
            </tbody>
          </table>

        </div>
      </div>
    </div>
  </div>
  <!-- Add and delete buttons for sellers, initially hidden -->
  <div id="sellerButtons" style="display: none;">
    <div class="container mt-4 ml-5">
      <div class="row">
        <div class="col-md-12">
          <button class="btn btn-primary" id="addSellerBtn" onclick="openModal()">Add Seller</button>
        </div>
        
        <div id="addSellerModal" class="modal" style="display: none;">
          <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Add Seller</h2>
            <form id="addSellerForm">
              <div class="form-group">
                <label for="sellerID">Seller ID:</label>
                <input type="text" class="form-control" id="sellerID" required>
              </div>
              <div class="form-group">
                <label for="sellerName">Name:</label>
                <input type="text" class="form-control" id="sellerName" required>
              </div>
              <div class="form-group">
                <label for="sellerEmail">Email:</label>
                <input type="email" class="form-control" id="sellerEmail" required>
              </div>
              <div class="form-group">
                <label for="sellerContact">Contact No:</label>
                <input type="tel" class="form-control" id="sellerContact" required>
              </div>
              <button type="submit" class="btn btn-primary">Add Seller</button>
            </form>
          </div>
        </div>
        
        
        
      </div>
    </div>
  </div>

  <!-- Products table, initially hidden -->
  <div id="productsSection" style="display: none;">
    <div class="container mt-4 ml-5">
      <div class="row">
        <div class="col-md-12">
          <h2>Top Selling Products</h2>
          <table class="table">
            <thead class="thead-dark">
              <tr>
                <th>Image</th>
                <th>Name</th>
                <th>Description</th>
                <th>Price</th>
                <th>Stock</th>
            </tr>
            {% for product in products %}
            <tr>
                <td>
                    {% with product.product_images.first as product_image %}
                        {% if product_image and product_image.image %}
                            <img src="{{ product_image.image.url }}" alt="{{ product.product_name }}" style="height: 50px;"/>
                        {% else %}
                            No image available
                        {% endif %}
                    {% endwith %}
                </td>
                <td>{{ product.product_name }}</td>
                <td>{{ product.product_description }}</td>
                <td>{{ product.price }}</td>
                <td>{{ product.stock }}</td>
            </tr>
            {% endfor %}
          </table>
            <!-- Sample data, replace with dynamic data -->
        </div>
      </div>
    </div>
  </div>
  <!-- Add and delete buttons for products, initially hidden -->
  <div id="productButtons" style="display: none;">
    <div class="container mt-4 ml-5">
      <div class="row">
        <div class="col-md-12">
          <button class="btn btn-primary" id="addProductBtn" data-toggle="modal" data-target="#addProductModal">Add Product</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal for adding a product -->
  <div class="modal fade" id="addProductModal" tabindex="-1" role="dialog" aria-labelledby="addProductModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addProductModalLabel">Add Product</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

          {% load static %} 
          
          

          <form method="post" enctype="multipart/form-data">  <!-- Required for file uploads -->
            {% csrf_token %}
            {{ form.as_p }}  <!-- Render the main product form -->
        
            <!-- Render color variants -->
            {{ color_formset.management_form }}  <!-- Ensure management form is included -->
            <h3>Color Variants</h3>
            <div id="color-section">
                {% for color_form in color_formset %}
                    {{ color_form.as_p }}
                {% endfor %}
            </div>
            <button type="button" onclick="addColorVariant()">+ Add Color Variant</button>
        
            <!-- Render size variants -->
            {{ size_formset.management_form }}
            <h3>Size Variants</h3>
            <div id="size-section">
                {% for size_form in size_formset %}
                    {{ size_form.as_p }}
                {% endfor %}
            </div>
            <button type="button" onclick="addSizeVariant()">+ Add Size Variant</button>
        
            <!-- Render product images -->
            {{ image_formset.management_form }}
            <h3>Product Images</h3>
            <div id="image-section">
                {% for image_form in image_formset %}
                    {{ image_form.as_p }}
                {% endfor %}
            </div>
            <button type="button" onclick="addImage()">+ Add Product Image</button>
        
            <button type="submit">Add Product</button>
        </form>
        
      <script>
        // JavaScript to add color variants dynamically
        function addColorVariant() {
          const colorSection = document.getElementById('color-section');
          const colorFormsetTotal = document.querySelector('[name=color-TOTAL_FORMS]');
          const currentForms = parseInt(colorFormsetTotal.value, 10);
      
          if (currentForms < 5) {  // Limit to avoid excessive form addition
              const newColorForm = document.createElement('div');
              newColorForm.innerHTML = '{{ color_formset.empty_form.as_p|escapejs }}';  // Ensure correct form rendering
              colorFormsetTotal.value = currentForms + 1;  // Increment the form count
              colorSection.appendChild(newColorForm);  // Add to the DOM
          } else {
              alert('Maximum 5 color variants allowed.');
          }
      }
      
      

// JavaScript to add size variants dynamically
function addSizeVariant() {
  const sizeSection = document.getElementById('size-section');
  const sizeFormsetTotal = document.querySelector('[name=size-TOTAL_FORMS]');
  const currentForms = parseInt(sizeFormsetTotal.value, 10);

  if (currentForms < 5) {  // Limit to avoid excessive form addition
      const newSizeForm = document.createElement('div');
      newSizeForm.innerHTML = '{{ size_formset.empty_form.as_p|escapejs }}';  // Correct form rendering
      sizeFormsetTotal.value = currentForms + 1;  // Increment the form count
      sizeSection.appendChild(newSizeForm);  // Add to the DOM
  } else {
      alert('Maximum 5 size variants allowed.');
  }
}

function addImage() {
  const imageSection = document.getElementById('image-section');
  const imageFormsetTotal = document.querySelector('[name=image-TOTAL_FORMS]');
  const currentForms = parseInt(imageFormsetTotal.value, 10);

  if (currentForms < 5) {  // Limit to avoid excessive form addition
      const newImageForm = document.createElement('div');
      newImageForm.innerHTML = '{{ image_formset.empty_form.as_p|escapejs }}';  // Ensure correct form rendering
      imageFormsetTotal.value = currentForms + 1;  // Increment the form count
      imageSection.appendChild(newImageForm);  // Add to the DOM
  } else {
      alert('Maximum 5 images allowed.');
  }
}


      </script>        


          
          


        </div>
      </div>
    </div>
  </div>
  
  <!-- Teams section, initially hidden -->
<div id="teamsSection" style="display: none;">
  <div class="container mt-4 ml-5">
    <!-- <h2 id="Ram">Our Teams</h2> -->
    <div class="row">
      <!-- Member 1 -->
      <div class="col-md-4 mb-4">
        <div class="card">
          <img src="" class="card-img-top" alt="Team Member 1">
          <div class="card-body">
            <h5 class="card-title">Ruben Karki</h5>
            <p class="card-text">Position: ----</p>
            <p class="card-text">Email: @example.com</p>
            <p class="card-text">Phone: +1234567890</p>
          </div>
        </div>
      </div>
      <!-- Member 2 -->
      <div class="col-md-4 mb-4">
        <div class="card">
          <img src=".vscode/Aakash.jpg" class="card-img-top" alt="Team Member 2">
          <div class="card-body">
            <h5 class="card-title">Aakash Chhetri/h5>
            <p class="card-text">Position:-----</p>
            <p class="card-text">Email: j@example.com</p>
            <p class="card-text">Phone: +0987654321</p>
          </div>
        </div>
      </div>
      <!-- Member 3 -->
      <div class="col-md-4 mb-4">
        <div class="card">
          <img src="team_member3.jpg" class="card-img-top" alt="Team Member 3">
          <div class="card-body">
            <h5 class="card-title">Sabin Giri</h5>
            <p class="card-text">Position: -----/p>
            <p class="card-text">Email: @example.com</p>
            <p class="card-text">Phone: +9876543210</p>
          </div>
        </div>
      </div>
      <!-- Member 4 -->
      <div class="col-md-4 mb-4">
        <div class="card">
          <img src="team_member4.jpg" class="card-img-top" alt="Team Member 4">
          <div class="card-body">
            <h5 class="card-title">Trilochan Dhami</h5>
            <p class="card-text">Position: ------</p>
            <p class="card-text">Email: @example.com</p>
            <p class="card-text">Phone: +1234509876</p>
          </div>
        </div>
      </div>
      <!-- Member 5 -->
      <div class="col-md-4 mb-4">
        <div class="card">
          <img src="team_member5.jpg" class="card-img-top" alt="Team Member 5">
          <div class="card-body">
            <h5 class="card-title">Prabesh Puri</h5>
            <p class="card-text">Position: ------</p>
            <p class="card-text">Email: @example.com</p>
            <p class="card-text">Phone: +9876541230</p>
          </div>
        </div>
      </div>
      <!-- Member 6 -->
      <div class="col-md-4 mb-4">
        <div class="card">
          <img src="team_member6.jpg" class="card-img-top" alt="Team Member 6">
          <div class="card-body">
            <h5 class="card-title">Suman Paudel</h5>
            <p class="card-text">Position: ------</p>
            <p class="card-text">Email: @example.com</p>
            <p class="card-text">Phone: +1234598760</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
  // JavaScript to toggle visibility of sections and buttons when links are clicked
  document.getElementById("usersLink").addEventListener("click", function() {
    toggleSections("users");
  });

  document.getElementById("sellersLink").addEventListener("click", function() {
    toggleSections("sellers");
  });

  document.getElementById("productsLink").addEventListener("click", function() {
    toggleSections("products");
  });

  document.getElementById("teamsLink").addEventListener("click", function() {
    toggleSections("teams");
  });

  // Function to toggle visibility of sections and buttons
  function toggleSections(section) {
    document.getElementById("dashboardSection").style.display = (section === "dashboard") ? "block" : "none";
    document.getElementById("usersSection").style.display = (section === "users") ? "block" : "none";
    document.getElementById("userButtons").style.display = (section === "users") ? "block" : "none";
    document.getElementById("sellersSection").style.display = (section === "sellers") ? "block" : "none";
    document.getElementById("sellerButtons").style.display = (section === "sellers") ? "block" : "none";
    document.getElementById("productsSection").style.display = (section === "products") ? "block" : "none";
    document.getElementById("productButtons").style.display = (section === "products") ? "block" : "none";
    document.getElementById("teamsSection").style.display = (section === "teams") ? "block" : "none";
  }
  // Add event listeners for delete buttons
  document.querySelectorAll('.delete-user-btn').forEach(button => {
    button.addEventListener('click', function() {
      const row = button.closest('tr');
      const userId = row.querySelector('th').textContent;
      // Send a request to delete user with userId and remove the row on success
      // Example:
      // fetch(`/deleteUser/${userId}`, {
      //   method: 'DELETE'
      // })
      // .then(response => {
      //   if (response.ok) {
      //     row.remove();
      //   } else {
      //     // Handle error
      //   }
      // })
      // .catch(error => console.error('Error:', error));
      row.remove(); // For demonstration purpose, remove the row directly without actual deletion
    });
  });
  // JavaScript to handle form submission in the modal
document.getElementById("addUserForm").addEventListener("submit", function(event) {
  event.preventDefault(); // Prevent the default form submission

  // Get the input values
  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const phone = document.getElementById("phone").value;
  const location = document.getElementById("location").value;
  const dateJoined = document.getElementById("dateJoined").value;

  // Generate the new user ID based on the last user ID in the table
  const tableBody = document.getElementById("userTableBody");
  const lastRow = tableBody.rows[tableBody.rows.length - 1];
  const lastUserId = parseInt(lastRow.cells[0].textContent);
  const newUserId = lastUserId + 1;

  // Create a new row with the input values
  const newUserRow = document.createElement("tr");
  newUserRow.innerHTML = `
    <th scope="row">${newUserId}</th>
    <td>${name}</td>
    <td>${email}</td>
    <td>${phone}</td>
    <td>${dateJoined}</td>
  `;
  tableBody.appendChild(newUserRow);

  // Close the modal
  $('#addUserModal').modal('hide');

  // Reset the form fields
  document.getElementById("addUserForm").reset();
});
  // JavaScript to handle form submission in the modal
  document.getElementById("addUserForm").addEventListener("submit", function(event) {
    event.preventDefault(); // Prevent the default form submission

    // Get the input values
    const name = document.getElementById("name").value;
    const email = document.getElementById("email").value;
    const phone = document.getElementById("phone").value;
    const location = document.getElementById("location").value;
    const dateJoined = document.getElementById("dateJoined").value;

    // Generate the new user ID based on the last user ID in the table
    const tableBody = document.getElementById("userTableBody");
    const lastRow = tableBody.rows[tableBody.rows.length - 1];
    const lastUserId = parseInt(lastRow.cells[0].textContent);
    const newUserId = lastUserId + 1;

    // Create a new row with the input values
    const newUserRow = document.createElement("tr");
    newUserRow.innerHTML = `
      <th scope="row">${newUserId}</th>
      <td>${name}</td>
      <td>${email}</td>
      <td>${phone}</td>
      <td>${dateJoined}</td>
    `;
    tableBody.appendChild(newUserRow);

    // Close the modal
    $('#addUserModal').modal('hide');

    // Reset the form fields
    document.getElementById("addUserForm").reset();
  });



  function addImageField() {
    var imageFieldsDiv = document.getElementById("imageFields");
  
    // Create a new input element for image
    var imageField = document.createElement("div");
    imageField.innerHTML = `
      <div class="form-group">
        <label for="productImage">Image:</label>
        <input type="file" class="form-control" id="productImage" name="productImage[]" required>
      </div>
    `;
  
    // Append the new image input field to the imageFieldsDiv
    imageFieldsDiv.appendChild(imageField);
  }
  



// Function to open the modal
function openModal() {
  var modal = document.getElementById("addSellerModal");
  modal.style.display = "block";
}

// Function to close the modal
function closeModal() {
  var modal = document.getElementById("addSellerModal");
  modal.style.display = "none";
}

// Form submission handling
var addSellerForm = document.getElementById("addSellerForm");
addSellerForm.addEventListener("submit", function(event) {
  event.preventDefault();
  // Perform your form submission logic here
  // For example, you can collect the form data and send it to the server
  var sellerID = document.getElementById("sellerID").value;
  var sellerName = document.getElementById("sellerName").value;
  var sellerEmail = document.getElementById("sellerEmail").value;
  var sellerContact = document.getElementById("sellerContact").value;
  // Once you have the form data, you can process it accordingly
  // For now, let's just close the modal
  closeModal();
});


</script>  
<style>
  /* Custom CSS for Admin Dashboard */

  /* Sidebar */
  .sidebar {
    width: 250px;
    background-color: #5412e3bd;
    color: #fff;
    padding: 20px;
    height: 100vh;
    position: fixed;
    top: 0;
    left: 0;
    overflow-y: auto;
    transition: width 0.3s; 
  }
  
  .sidebar h2 {
    margin-bottom: 20px;
  }
  
  .sidebar ul {
    list-style: none;
    padding: 0;
  }
  
  .sidebar ul li {
    margin-bottom: 10px;
  }
  
  .sidebar ul li a {
    color: #fff;
    text-decoration: none;
    display: block;
    padding: 10px;
    transition: background-color 0.3s;
  }
  
  .sidebar ul li a:hover {
    background-color: #165aa2c6;
  }
  
  /* Active link style */
  .sidebar ul li a.active {
    background-color: #007bff;
  }
  
  /* Style the three boxes */
  .card {
    margin-bottom: 20px;
  }
  .card-title{
    text-align: center;
    color: rebeccapurple;
    font-size: 30px; 
    font-family: Arial, sans-serif; 
  }
  .card-text{
    font-size: 20px; 
    font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
    margin-left: 10px;
  
  }
  /* Style table header */
  .table thead th {
    text-align: center;
    background-color: rgb(7, 244, 188);
  }
  
  /* Style table data */
  .table tbody td {
    vertical-align: middle;
  }
  
  /* Responsive table */
  @media (max-width: 767px) {
    .table-responsive {
      overflow-x: auto;
    }
  }
  
  /* Adjust table font size for smaller screens */
  @media (max-width: 575px) {
    .table td, .table th {
      font-size: 12px;
    }
  }
  .container mt-4 ml-5{
    width: 100px;
    text-align: center;
    margin-left:35px;
  
  }
  .row {
    display: flex;
      -ms-flex-wrap: wrap;
      flex-wrap: wrap;
      margin-right: -100px;
      margin-left: 206px;
  }
  .card-img-top{
    padding: 20px;
    margin: 10px;
  }
  .ram{
    position: center;
  } 
</style>
</body>
</html>